using System;
using System.Collections.Generic;
using System.Linq;

namespace XiaomiWatch.Common.CheckSum
{
	public class Crc32a
	{
		private const uint s_generator = 3988292384u;

		private const uint s_generatorRev = 79764919u;

		private readonly uint[] m_checksumTable = new uint[400]
		{
			281233934u, 654117070u, 3236494948u, 1962469351u, 2422755260u, 1962060297u, 4109789052u, 2495887132u, 3349395785u, 3807498825u,
			4147392729u, 1338337615u, 4210607740u, 4002502406u, 618644983u, 3689026186u, 1737459875u, 1940712725u, 3440507702u, 347392801u,
			1099336126u, 2615281589u, 3211314658u, 694848599u, 1329212063u, 3158202680u, 582062455u, 3104172638u, 4125625679u, 1118998233u,
			474926060u, 283541754u, 901605776u, 918002975u, 4114895749u, 1073303182u, 3506942434u, 2523966937u, 2933149395u, 380654311u,
			3743066953u, 1095588451u, 2639237362u, 988722692u, 3383765722u, 1970405101u, 1340980545u, 2765116599u, 3746584330u, 2104366547u,
			2517091373u, 2831878279u, 1946870839u, 1763425552u, 2408954115u, 2286979222u, 3234308532u, 3847107231u, 4076999156u, 1504655602u,
			1873132995u, 1871481870u, 705489870u, 3459407809u, 1050329215u, 1460915055u, 2486404243u, 1866191211u, 1936657029u, 931955905u,
			1680875607u, 2482893172u, 1861172672u, 1440621832u, 1229359949u, 2085064903u, 3769654547u, 1933804952u, 2146248753u, 606496006u,
			1790000298u, 1106610020u, 3023975831u, 4286056407u, 2267134510u, 4005449710u, 1364627059u, 1630139823u, 4008404916u, 3558536343u,
			3573037851u, 3398536211u, 3058757014u, 2788813225u, 3901870828u, 2830785699u, 3198283787u, 3586986752u, 3573333868u, 658686947u,
			1450613396u, 477167310u, 349956514u, 1838138303u, 1026037143u, 2153226209u, 1760075343u, 707793082u, 3053835523u, 2220503557u,
			421789312u, 2453937816u, 1509474315u, 3180581129u, 571761322u, 1712598131u, 1425984383u, 4127887183u, 2112860310u, 2337309582u,
			906600572u, 3667222800u, 436795693u, 3538776394u, 3840600302u, 3472350342u, 3730709011u, 1295322472u, 2933167942u, 818169416u,
			1811798643u, 1796022755u, 1147720715u, 3560761836u, 1650671278u, 2506975123u, 1424798585u, 2170194889u, 1030305067u, 1429429228u,
			3549763957u, 602434355u, 2519947237u, 358395839u, 3359139214u, 3423244534u, 3189905453u, 2052708254u, 2732626332u, 2956771204u,
			2611102570u, 1055121406u, 4181709867u, 3864969308u, 2649354756u, 759631253u, 2076406079u, 3306972203u, 1576473511u, 3403578673u,
			3920161971u, 3217700248u, 3254749128u, 3603966328u, 1244883722u, 633121664u, 441277445u, 1675847560u, 780358057u, 2889852795u,
			1324818258u, 2900583189u, 964625512u, 1604796583u, 2679038868u, 2624878559u, 422079283u, 3564716311u, 1653280699u, 1714426659u,
			3807116114u, 3687758937u, 2996367699u, 738973898u, 3610221008u, 4266608537u, 4018033122u, 957261294u, 388056539u, 645566222u,
			2928628781u, 421573883u, 2368323155u, 1387175445u, 3754740926u, 3955361152u, 3143971764u, 2082724353u, 2207415306u, 1876323894u,
			1822693170u, 3388173130u, 2260364896u, 2101159392u, 1905662047u, 2179291489u, 1708556750u, 424531005u, 2426215910u, 357172192u,
			1763635124u, 1946010759u, 2678178327u, 3115981619u, 3770918617u, 1290086536u, 2520824205u, 3042038899u, 414353200u, 1601985299u,
			2443601974u, 3554136038u, 472298063u, 3622235860u, 2384954027u, 4086521048u, 2365435015u, 4011305856u, 4291139995u, 2389803319u,
			1634107817u, 3698052795u, 3689835849u, 1146768742u, 1418596261u, 4192916740u, 4127656180u, 1894463512u, 2660508101u, 4289413654u,
			1921300321u, 4261170937u, 4232452119u, 1857592316u, 2646222278u, 511052013u, 945682697u, 3381683596u, 659141913u, 3801415211u,
			2289705036u, 1841379976u, 4282181814u, 3172798148u, 1971856564u, 3828682070u, 2804229525u, 1282594158u, 283374847u, 938584184u,
			3648298964u, 1098846516u, 3071587347u, 3691471520u, 2061950239u, 4287816703u, 4266852197u, 3058876732u, 2299679849u, 509575048u,
			1651019366u, 2760999125u, 2715036407u, 3603788744u, 956268637u, 283308606u, 3295088322u, 1427589593u, 4090159415u, 2013047952u,
			3824421899u, 3420342478u, 3740257181u, 2563893579u, 2443005206u, 1694445974u, 333527421u, 858093951u, 283012781u, 2234441902u,
			1042462242u, 1117668093u, 3155948018u, 2888920921u, 1630588881u, 2310000149u, 3039305972u, 1091953995u, 2582521519u, 3682871310u,
			2683900023u, 1525644018u, 3073775873u, 2124072238u, 3892083435u, 1285909563u, 4184284629u, 560432198u, 3458119844u, 3691631453u,
			2645867771u, 3095337003u, 2492987287u, 4131634899u, 3719928781u, 2203283615u, 4152336757u, 2834032881u, 1578453364u, 950189128u,
			1666641968u, 582012108u, 1313192329u, 1424797300u, 3433594289u, 3810623209u, 3075514454u, 4282355972u, 2016267975u, 2047433384u,
			2144256452u, 1561522058u, 2756713858u, 4283235325u, 3120181997u, 3559377474u, 2319313824u, 504674466u, 2617841381u, 1600396804u,
			2716788073u, 441642512u, 2408821910u, 1561649909u, 3574011185u, 598890365u, 356128985u, 2725706181u, 1951732209u, 2852621813u,
			4193159456u, 308632723u, 330678985u, 996061859u, 313413425u, 1384136257u, 2415065972u, 1789595637u, 4257585567u, 4220917803u,
			1227887628u, 4267745457u, 1639516869u, 4224794590u, 2111562327u, 2914304289u, 572563631u, 3345924233u, 3060969032u, 3539789888u,
			2335503926u, 1522602443u, 2040323447u, 707308852u, 3654138613u, 1496191536u, 496719232u, 3747826733u, 691587227u, 1407621837u,
			384856886u, 694039390u, 330661948u, 1856862383u, 841040195u, 2699436131u, 3814586408u, 645459538u, 2233741967u, 1313940379u,
			731559445u, 523187335u, 3495216835u, 3386524941u, 2943271479u, 501117520u, 1210565532u, 1471750217u, 2998176529u, 3997562999u
		};

		public Crc32a(bool rev = false)
		{
		}

		public uint Get<T>(IEnumerable<T> byteStream)
		{
			try
			{
				return ~byteStream.Aggregate(uint.MaxValue, (uint checksumRegister, T currentByte) => m_checksumTable[(checksumRegister & 0xFF) ^ Convert.ToByte(currentByte)] ^ (checksumRegister >> 8));
			}
			catch (FormatException innerException)
			{
				throw new Exception("Could not read the stream out as bytes.", innerException);
			}
			catch (InvalidCastException innerException2)
			{
				throw new Exception("Could not read the stream out as bytes.", innerException2);
			}
			catch (OverflowException innerException3)
			{
				throw new Exception("Could not read the stream out as bytes.", innerException3);
			}
		}

		public uint Get<T>(IEnumerable<T> byteStream, uint initValue)
		{
			try
			{
				return ~byteStream.Aggregate(initValue, (uint checksumRegister, T currentByte) => m_checksumTable[(checksumRegister & 0xFF) ^ Convert.ToByte(currentByte)] ^ (checksumRegister >> 8));
			}
			catch (FormatException innerException)
			{
				throw new Exception("Could not read the stream out as bytes.", innerException);
			}
			catch (InvalidCastException innerException2)
			{
				throw new Exception("Could not read the stream out as bytes.", innerException2);
			}
			catch (OverflowException innerException3)
			{
				throw new Exception("Could not read the stream out as bytes.", innerException3);
			}
		}

		public uint GetZero<T>(IEnumerable<T> byteStream)
		{
			try
			{
				uint seed = 0u;
				return ~byteStream.Aggregate(seed, (uint checksumRegister, T currentByte) => m_checksumTable[(checksumRegister & 0xFF) ^ Convert.ToByte(currentByte)] ^ (checksumRegister >> 8));
			}
			catch (FormatException innerException)
			{
				throw new Exception("Could not read the stream out as bytes.", innerException);
			}
			catch (InvalidCastException innerException2)
			{
				throw new Exception("Could not read the stream out as bytes.", innerException2);
			}
			catch (OverflowException innerException3)
			{
				throw new Exception("Could not read the stream out as bytes.", innerException3);
			}
		}

		public uint GetOTA<T>(IEnumerable<T> byteStream)
		{
			try
			{
				uint seed = 0u;
				return byteStream.Aggregate(seed, (uint checksumRegister, T currentByte) => m_checksumTable[(checksumRegister & 0xFF) ^ Convert.ToByte(currentByte)] ^ (checksumRegister >> 8));
			}
			catch (FormatException innerException)
			{
				throw new Exception("Could not read the stream out as bytes.", innerException);
			}
			catch (InvalidCastException innerException2)
			{
				throw new Exception("Could not read the stream out as bytes.", innerException2);
			}
			catch (OverflowException innerException3)
			{
				throw new Exception("Could not read the stream out as bytes.", innerException3);
			}
		}
	}
}
